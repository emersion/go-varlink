// Code generated by go-varlink/varlinkgen. DO NOT EDIT.

package certification

import (
	"encoding/json"
	govarlink "github.com/emersion/go-varlink"
)

type Interface struct {
	Anon struct {
		Bar bool `json:"bar"`
		Foo bool `json:"foo"`
	} `json:"anon"`
	Foo *[]*map[string]string `json:"foo,omitempty"`
}
type MyType struct {
	Array               []string          `json:"array"`
	Dictionary          map[string]string `json:"dictionary"`
	Enum                string            `json:"enum"`
	Interface           Interface         `json:"interface"`
	Nullable            *string           `json:"nullable,omitempty"`
	NullableArrayStruct *[]struct {
		First  int    `json:"first"`
		Second string `json:"second"`
	} `json:"nullable_array_struct,omitempty"`
	Object    json.RawMessage     `json:"object"`
	Stringset map[string]struct{} `json:"stringset"`
	Struct    struct {
		First  int    `json:"first"`
		Second string `json:"second"`
	} `json:"struct"`
}

type CertificationErrorError struct {
	Got   json.RawMessage `json:"got"`
	Wants json.RawMessage `json:"wants"`
}

func (err *CertificationErrorError) Error() string {
	return "varlink call failed: org.varlink.certification.CertificationError"
}

type ClientIdErrorError struct{}

func (err *ClientIdErrorError) Error() string {
	return "varlink call failed: org.varlink.certification.ClientIdError"
}

type EndIn struct {
	ClientId string `json:"client_id"`
}
type EndOut struct {
	AllOk bool `json:"all_ok"`
}

type StartIn struct{}
type StartOut struct {
	ClientId string `json:"client_id"`
}

type Test01In struct {
	ClientId string `json:"client_id"`
}
type Test01Out struct {
	Bool bool `json:"bool"`
}

type Test02In struct {
	Bool     bool   `json:"bool"`
	ClientId string `json:"client_id"`
}
type Test02Out struct {
	Int int `json:"int"`
}

type Test03In struct {
	ClientId string `json:"client_id"`
	Int      int    `json:"int"`
}
type Test03Out struct {
	Float float64 `json:"float"`
}

type Test04In struct {
	ClientId string  `json:"client_id"`
	Float    float64 `json:"float"`
}
type Test04Out struct {
	String string `json:"string"`
}

type Test05In struct {
	ClientId string `json:"client_id"`
	String   string `json:"string"`
}
type Test05Out struct {
	Bool   bool    `json:"bool"`
	Float  float64 `json:"float"`
	Int    int     `json:"int"`
	String string  `json:"string"`
}

type Test06In struct {
	Bool     bool    `json:"bool"`
	ClientId string  `json:"client_id"`
	Float    float64 `json:"float"`
	Int      int     `json:"int"`
	String   string  `json:"string"`
}
type Test06Out struct {
	Struct struct {
		Bool   bool    `json:"bool"`
		Float  float64 `json:"float"`
		Int    int     `json:"int"`
		String string  `json:"string"`
	} `json:"struct"`
}

type Test07In struct {
	ClientId string `json:"client_id"`
	Struct   struct {
		Bool   bool    `json:"bool"`
		Float  float64 `json:"float"`
		Int    int     `json:"int"`
		String string  `json:"string"`
	} `json:"struct"`
}
type Test07Out struct {
	Map map[string]string `json:"map"`
}

type Test08In struct {
	ClientId string            `json:"client_id"`
	Map      map[string]string `json:"map"`
}
type Test08Out struct {
	Set map[string]struct{} `json:"set"`
}

type Test09In struct {
	ClientId string              `json:"client_id"`
	Set      map[string]struct{} `json:"set"`
}
type Test09Out struct {
	Mytype MyType `json:"mytype"`
}

type Test10In struct {
	ClientId string `json:"client_id"`
	Mytype   MyType `json:"mytype"`
}
type Test10Out struct {
	String string `json:"string"`
}

type Test11In struct {
	ClientId        string   `json:"client_id"`
	LastMoreReplies []string `json:"last_more_replies"`
}
type Test11Out struct{}

type Client struct {
	*govarlink.Client
}

func unmarshalError(err error) error {
	verr, ok := err.(*govarlink.ClientError)
	if !ok {
		return err
	}
	var v error
	switch verr.Name {
	case "org.varlink.certification.CertificationError":
		v = new(CertificationErrorError)
	case "org.varlink.certification.ClientIdError":
		v = new(ClientIdErrorError)
	default:
		return err
	}
	if err := json.Unmarshal(verr.Parameters, v); err != nil {
		return err
	}
	return v
}
func (c Client) End(in *EndIn) (*EndOut, error) {
	if in == nil {
		in = new(EndIn)
	}
	out := new(EndOut)
	err := c.Client.Do("org.varlink.certification.End", in, out)
	return out, unmarshalError(err)
}
func (c Client) Start(in *StartIn) (*StartOut, error) {
	if in == nil {
		in = new(StartIn)
	}
	out := new(StartOut)
	err := c.Client.Do("org.varlink.certification.Start", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test01(in *Test01In) (*Test01Out, error) {
	if in == nil {
		in = new(Test01In)
	}
	out := new(Test01Out)
	err := c.Client.Do("org.varlink.certification.Test01", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test02(in *Test02In) (*Test02Out, error) {
	if in == nil {
		in = new(Test02In)
	}
	out := new(Test02Out)
	err := c.Client.Do("org.varlink.certification.Test02", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test03(in *Test03In) (*Test03Out, error) {
	if in == nil {
		in = new(Test03In)
	}
	out := new(Test03Out)
	err := c.Client.Do("org.varlink.certification.Test03", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test04(in *Test04In) (*Test04Out, error) {
	if in == nil {
		in = new(Test04In)
	}
	out := new(Test04Out)
	err := c.Client.Do("org.varlink.certification.Test04", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test05(in *Test05In) (*Test05Out, error) {
	if in == nil {
		in = new(Test05In)
	}
	out := new(Test05Out)
	err := c.Client.Do("org.varlink.certification.Test05", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test06(in *Test06In) (*Test06Out, error) {
	if in == nil {
		in = new(Test06In)
	}
	out := new(Test06Out)
	err := c.Client.Do("org.varlink.certification.Test06", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test07(in *Test07In) (*Test07Out, error) {
	if in == nil {
		in = new(Test07In)
	}
	out := new(Test07Out)
	err := c.Client.Do("org.varlink.certification.Test07", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test08(in *Test08In) (*Test08Out, error) {
	if in == nil {
		in = new(Test08In)
	}
	out := new(Test08Out)
	err := c.Client.Do("org.varlink.certification.Test08", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test09(in *Test09In) (*Test09Out, error) {
	if in == nil {
		in = new(Test09In)
	}
	out := new(Test09Out)
	err := c.Client.Do("org.varlink.certification.Test09", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test10(in *Test10In) (*Test10Out, error) {
	if in == nil {
		in = new(Test10In)
	}
	out := new(Test10Out)
	err := c.Client.Do("org.varlink.certification.Test10", in, out)
	return out, unmarshalError(err)
}
func (c Client) Test11(in *Test11In) (*Test11Out, error) {
	if in == nil {
		in = new(Test11In)
	}
	out := new(Test11Out)
	err := c.Client.Do("org.varlink.certification.Test11", in, out)
	return out, unmarshalError(err)
}

type Backend interface {
	End(*EndIn) (*EndOut, error)
	Start(*StartIn) (*StartOut, error)
	Test01(*Test01In) (*Test01Out, error)
	Test02(*Test02In) (*Test02Out, error)
	Test03(*Test03In) (*Test03Out, error)
	Test04(*Test04In) (*Test04Out, error)
	Test05(*Test05In) (*Test05Out, error)
	Test06(*Test06In) (*Test06Out, error)
	Test07(*Test07In) (*Test07Out, error)
	Test08(*Test08In) (*Test08Out, error)
	Test09(*Test09In) (*Test09Out, error)
	Test10(*Test10In) (*Test10Out, error)
	Test11(*Test11In) (*Test11Out, error)
}

type Handler struct {
	Backend Backend
}

func marshalError(err error) error {
	var name string
	switch err.(type) {
	case *CertificationErrorError:
		name = "org.varlink.certification.CertificationError"
	case *ClientIdErrorError:
		name = "org.varlink.certification.ClientIdError"
	default:
		return err
	}
	return &govarlink.ServerError{
		Name:       name,
		Parameters: err,
	}
}
func (h Handler) HandleVarlink(call *govarlink.ServerCall, req *govarlink.ServerRequest) error {
	var (
		out interface{}
		err error
	)
	switch req.Method {
	case "org.varlink.certification.End":
		in := new(EndIn)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.End(in)
	case "org.varlink.certification.Start":
		in := new(StartIn)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Start(in)
	case "org.varlink.certification.Test01":
		in := new(Test01In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test01(in)
	case "org.varlink.certification.Test02":
		in := new(Test02In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test02(in)
	case "org.varlink.certification.Test03":
		in := new(Test03In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test03(in)
	case "org.varlink.certification.Test04":
		in := new(Test04In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test04(in)
	case "org.varlink.certification.Test05":
		in := new(Test05In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test05(in)
	case "org.varlink.certification.Test06":
		in := new(Test06In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test06(in)
	case "org.varlink.certification.Test07":
		in := new(Test07In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test07(in)
	case "org.varlink.certification.Test08":
		in := new(Test08In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test08(in)
	case "org.varlink.certification.Test09":
		in := new(Test09In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test09(in)
	case "org.varlink.certification.Test10":
		in := new(Test10In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test10(in)
	case "org.varlink.certification.Test11":
		in := new(Test11In)
		if err := json.Unmarshal(req.Parameters, in); err != nil {
			return err
		}
		out, err = h.Backend.Test11(in)
	default:
		err = &govarlink.ServerError{
			Name:       "org.varlink.service.MethodNotFound",
			Parameters: map[string]string{"method": req.Method},
		}
	}
	if err != nil {
		return marshalError(err)
	}
	return call.CloseWithReply(out)
}

func (h Handler) Register(reg *govarlink.Registry) {
	reg.Add(&govarlink.RegistryInterface{
		Definition: "# Interface to test varlink implementations against.\n# First you write a varlink client calling:\n# Start, Test01, Test02, â€¦, Test09, End\n# The return value of the previous call should be the argument of the next call.\n# Then you test this client against well known servers like python or rust from\n# https://github.com/varlink/\n#\n# Next you write a varlink server providing the same service as the well known ones.\n# Now run your client against it and run well known clients like python or rust\n# from https://github.com/varlink/ against your server. If all works out, then\n# your new language bindings should be varlink certified.\ninterface org.varlink.certification\n\ntype Interface (\n  foo: ?[]?[string](foo, bar, baz),\n  anon: (foo: bool, bar: bool)\n)\n\ntype MyType (\n  object: object,\n  enum: (one, two, three),\n  struct: (first: int, second: string),\n  array: []string,\n  dictionary: [string]string,\n  stringset: [string](),\n  nullable: ?string,\n  nullable_array_struct: ?[](first: int, second: string),\n  interface: Interface\n)\n\nmethod Start() -> (client_id: string)\n\nmethod Test01(client_id: string) -> (bool: bool)\n\nmethod Test02(client_id: string, bool: bool) -> (int: int)\n\nmethod Test03(client_id: string, int: int) -> (float: float)\n\nmethod Test04(client_id: string, float: float) -> (string: string)\n\nmethod Test05(client_id: string, string: string) -> (\n  bool: bool,\n  int: int,\n  float: float,\n  string: string\n)\n\nmethod Test06(\n  client_id: string,\n  bool: bool,\n  int: int,\n  float: float,\n  string: string\n) -> (\n  struct: (\n    bool: bool,\n    int: int,\n    float: float,\n    string: string\n  )\n)\n\nmethod Test07(\n  client_id: string,\n  struct: (\n    bool: bool,\n    int: int,\n    float: float,\n    string: string\n  )\n) -> (map: [string]string)\n\nmethod Test08(client_id: string, map: [string]string) -> (set: [string]())\n\nmethod Test09(client_id: string, set: [string]()) -> (mytype: MyType)\n\n# returns more than one reply with \"continues\"\nmethod Test10(client_id: string, mytype: MyType) -> (string: string)\n\n# must be called as \"oneway\"\nmethod Test11(client_id: string, last_more_replies: []string) -> ()\n\nmethod End(client_id: string) -> (all_ok: bool)\n\nerror ClientIdError ()\nerror CertificationError (wants: object, got: object)\n",
		Name:       "org.varlink.certification",
	}, h)
}
